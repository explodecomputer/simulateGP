<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data generating process for genetic effects on complex traits with interactions • simulateGP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data generating process for genetic effects on complex traits with interactions">
<meta property="og:description" content="simulateGP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simulateGP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Guide</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/explodecomputer/simulateGP" class="external-link">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data generating process for genetic effects on
complex traits with interactions</h1>
                        <h4 data-toc-skip class="author">Gibran
Hemani</h4>
            
            <h4 data-toc-skip class="date">2024-04-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/explodecomputer/simulateGP/blob/HEAD/vignettes/mr_dgp.rmd" class="external-link"><code>vignettes/mr_dgp.rmd</code></a></small>
      <div class="hidden name"><code>mr_dgp.rmd</code></div>

    </div>

    
    
<p>Background: <a href="http://proceedings.mlr.press/v70/hartford17a.html" class="external-link">Deep IV</a> can
infer causal effects in which the sample is stratified by one or many
covariates, and there is a different causal effect within each
stratum.</p>
<p>The covariates don’t necessarily need to be directly measured, could
have a large number of proxy variables for example.</p>
<div class="section level2">
<h2 id="genetic-effects">Genetic effects<a class="anchor" aria-label="anchor" href="#genetic-effects"></a>
</h2>
<p>To be realistic, obtain known associations for BMI:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MRCIEU/ieugwasr" class="external-link">ieugwasr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Warning:</span></span>
<span><span class="co">## You are running an old version of the ieugwasr package.</span></span>
<span><span class="co">## This version:   0.2.0</span></span>
<span><span class="co">## Latest version: 0.2.2-9000</span></span>
<span><span class="co">## Please consider updating using remotes::install_github('MRCIEU/ieugwasr')</span></span></code></pre>
<pre><code><span><span class="co">## OpenGWAS updates:</span></span></code></pre>
<pre><code><span><span class="co">##   Date: 2024-03-07</span></span></code></pre>
<pre><code><span><span class="co">##   [&gt;] There is exceptional load on the OpenGWAS servers.</span></span></code></pre>
<pre><code><span><span class="co">##   [&gt;] Urgent infrastructure development being performed.</span></span></code></pre>
<pre><code><span><span class="co">##   [&gt;] See local options for analysis: https://mrcieu.github.io/gwasvcf/.</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/ggdag" class="external-link">ggdag</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'ggdag'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.dagitty.net" class="external-link">dagitty</a></span><span class="op">)</span></span>
<span><span class="va">bmi_hits</span> <span class="op">&lt;-</span> <span class="fu">ieugwasr</span><span class="fu">::</span><span class="fu"><a href="https://mrcieu.github.io/ieugwasr/reference/tophits.html" class="external-link">tophits</a></span><span class="op">(</span><span class="st">"ukb-b-19953"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bmi_hits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tibble [458 × 12] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ n       : num [1:458] 461460 461460 461460 461460 461460 ...</span></span>
<span><span class="co">##  $ se      : num [1:458] 0.00261 0.00346 0.00237 0.00622 0.0046 ...</span></span>
<span><span class="co">##  $ position: int [1:458] 32196647 62579891 98315893 110082551 111338672 112324111 156489974 174321997 11207269 16848652 ...</span></span>
<span><span class="co">##  $ p       : num [1:458] 8.0e-10 1.2e-21 3.3e-11 4.0e-28 2.5e-08 ...</span></span>
<span><span class="co">##  $ chr     : chr [1:458] "1" "1" "1" "1" ...</span></span>
<span><span class="co">##  $ beta    : num [1:458] 0.0161 -0.0331 0.0157 0.0684 -0.0256 ...</span></span>
<span><span class="co">##  $ id      : chr [1:458] "ukb-b-19953" "ukb-b-19953" "ukb-b-19953" "ukb-b-19953" ...</span></span>
<span><span class="co">##  $ rsid    : chr [1:458] "rs909001" "rs12140153" "rs12072739" "rs41279738" ...</span></span>
<span><span class="co">##  $ ea      : chr [1:458] "G" "T" "G" "G" ...</span></span>
<span><span class="co">##  $ nea     : chr [1:458] "C" "G" "A" "T" ...</span></span>
<span><span class="co">##  $ eaf     : num [1:458] 0.1721 0.0943 0.2245 0.026 0.0483 ...</span></span>
<span><span class="co">##  $ trait   : chr [1:458] "Body mass index (BMI)" "Body mass index (BMI)" "Body mass index (BMI)" "Body mass index (BMI)" ...</span></span></code></pre>
<p>There are 458 independent instruments for BMI. All the instruments
have small effects:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">rsq</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">bmi_hits</span><span class="op">$</span><span class="va">beta</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">bmi_hits</span><span class="op">$</span><span class="va">eaf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">bmi_hits</span><span class="op">$</span><span class="va">eaf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">rsq</span>, breaks<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>In total the 458 BMI hits explain 5.7329823% of the variance in
BMI.</p>
<p>What is the effect on coronary heart disease?</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chd_assoc</span> <span class="op">&lt;-</span> <span class="fu">ieugwasr</span><span class="fu">::</span><span class="fu"><a href="https://mrcieu.github.io/ieugwasr/reference/associations.html" class="external-link">associations</a></span><span class="op">(</span>variants<span class="op">=</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">rsid</span>, id<span class="op">=</span><span class="st">"ieu-a-7"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">bmi_hits</span>, <span class="va">chd_assoc</span>, by<span class="op">=</span><span class="st">"rsid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    451 obs. of  31 variables:</span></span>
<span><span class="co">##  $ rsid      : chr  "rs1000096" "rs10063055" "rs10099330" "rs10160769" ...</span></span>
<span><span class="co">##  $ n.x       : num  461460 461460 461460 461460 461460 ...</span></span>
<span><span class="co">##  $ se.x      : num  0.00203 0.00227 0.00199 0.00242 0.00206 ...</span></span>
<span><span class="co">##  $ position.x: int  38692835 140990108 143383694 76474827 41637688 208307761 104242992 46182304 19288508 118650996 ...</span></span>
<span><span class="co">##  $ p.x       : num  5.1e-11 1.7e-09 4.2e-10 1.2e-10 3.0e-09 ...</span></span>
<span><span class="co">##  $ chr.x     : chr  "4" "5" "8" "11" ...</span></span>
<span><span class="co">##  $ beta.x    : num  -0.0133 0.0137 0.0124 -0.0156 0.0122 ...</span></span>
<span><span class="co">##  $ id.x      : chr  "ukb-b-19953" "ukb-b-19953" "ukb-b-19953" "ukb-b-19953" ...</span></span>
<span><span class="co">##  $ ea.x      : chr  "T" "T" "G" "C" ...</span></span>
<span><span class="co">##  $ nea.x     : chr  "C" "C" "A" "G" ...</span></span>
<span><span class="co">##  $ eaf.x     : num  0.401 0.253 0.453 0.218 0.363 ...</span></span>
<span><span class="co">##  $ trait.x   : chr  "Body mass index (BMI)" "Body mass index (BMI)" "Body mass index (BMI)" "Body mass index (BMI)" ...</span></span>
<span><span class="co">##  $ rsq       : num  8.55e-05 7.08e-05 7.65e-05 8.27e-05 6.87e-05 ...</span></span>
<span><span class="co">##  $ n.y       : int  184305 184305 184305 184305 184305 184305 184305 184305 184305 184305 ...</span></span>
<span><span class="co">##  $ chr.y     : chr  "4" "5" "8" "11" ...</span></span>
<span><span class="co">##  $ beta.y    : num  0.01491 0.03096 0.01195 -0.00819 0.01167 ...</span></span>
<span><span class="co">##  $ p.y       : num  0.12515 0.00507 0.1991 0.46067 0.24353 ...</span></span>
<span><span class="co">##  $ se.y      : num  0.00972 0.01105 0.0093 0.0111 0.01001 ...</span></span>
<span><span class="co">##  $ position.y: int  38692835 140990108 143383694 76474827 41637688 208307761 104242992 46182304 19288508 118650996 ...</span></span>
<span><span class="co">##  $ id.y      : chr  "ieu-a-7" "ieu-a-7" "ieu-a-7" "ieu-a-7" ...</span></span>
<span><span class="co">##  $ ea.y      : chr  "T" "T" "G" "C" ...</span></span>
<span><span class="co">##  $ nea.y     : chr  "C" "C" "A" "G" ...</span></span>
<span><span class="co">##  $ eaf.y     : num  0.357 0.229 0.464 0.239 0.344 ...</span></span>
<span><span class="co">##  $ target_snp: chr  "rs1000096" "rs10063055" "rs10099330" "rs10160769" ...</span></span>
<span><span class="co">##  $ proxy_snp : chr  "rs1000096" "rs10063055" "rs10099330" "rs10160769" ...</span></span>
<span><span class="co">##  $ proxy     : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">##  $ target_a1 : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ target_a2 : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ proxy_a1  : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ proxy_a2  : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ trait.y   : chr  "Coronary heart disease" "Coronary heart disease" "Coronary heart disease" "Coronary heart disease" ...</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">beta.y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">beta.x</span>, <span class="va">dat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">dat</span><span class="op">$</span><span class="va">se.y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = beta.y ~ 0 + beta.x, data = dat, weights = 1/dat$se.y^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -6.0599 -0.7480 -0.0190  0.7966  6.7100 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##        Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## beta.x  0.41287    0.03529    11.7   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.239 on 450 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.2332, Adjusted R-squared:  0.2315 </span></span>
<span><span class="co">## F-statistic: 136.9 on 1 and 450 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<p>This is a pretty big effect. So use that as a ceiling. Need a model
to relate variance explained by all the variants, the effect sizes, and
the minor allele frequencies (MAFs) of the variants</p>
<p>The variance explained by a variant <span class="math inline">\(G_j\)</span> is related to</p>
<p><span class="math display">\[
V_{G_j} = 2 \beta_j p_j (1-p_j)
\]</span> where <span class="math inline">\(p_j\)</span> is the minor
allele frequency of the variant, and <span class="math inline">\(\beta_j\)</span> is its effect size. What is the
distribution of allele frequencies of instruments for BMI?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span> <span class="op">&lt;-</span> <span class="va">bmi_hits</span><span class="op">$</span><span class="va">eaf</span></span>
<span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span><span class="op">[</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span><span class="op">[</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>And the relationship between MAF and effect size</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">maf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">bmi_hits</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Deciding how the the effect sizes relate to allele frequency depends
on model of natural selection, parameter <span class="math inline">\(S\)</span>, which can inform the sampling of the
SNP effect sizes like this:</p>
<p><span class="math display">\[
\beta_j \sim N(0, [2p_j (1-p_j)]^S \sigma^2_\beta)
\]</span></p>
<p>Here <span class="math inline">\(\sigma^2_\beta = V_G / M\)</span>
where <span class="math inline">\(M\)</span> is the number of causal
variants for the trait and <span class="math inline">\(V_G\)</span> is
the variance explained by all those SNPs, which relates to the
heritability equation of <span class="math inline">\(h^2 = V_G /
V_P\)</span>, where <span class="math inline">\(V_P\)</span> is the
phenotypic variance.</p>
<p>Problem with this model is that if we assume that all the instruments
explain the entire variance of the trait then a lot of the <span class="math inline">\(\beta_j\)</span> values will be too small to be
realistic instruments. So the strategy would be to</p>
<ol style="list-style-type: decimal">
<li>Choose a number of causal variants for the trait (large,
e.g. &gt;10000)</li>
<li>Sample the allele frequency distribution of all causal variants</li>
<li>Sample the effects for all causal variants</li>
<li>Retain only those that cumulatively explain some amount of variance.
e.g. For BMI, the variance exlained is 2, so we just want the set of
variants that are required to explain that much variance.</li>
</ol>
<p>Ultimately, we can draw allele frequencies from some distribution
e.g.</p>
<p><span class="math display">\[
p_j \sim Beta(\alpha=2,\beta=2)
\]</span></p>
<p>This would approx match the frequencies of the instruments for
BMI:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>But it’s probably not representative of the full set of causal
variants, because we have more power to detect common variants. Perhaps
just use a uniform distribution. Bringing it all together:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Generate realistic variant effects from GWAS</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param af Array of allele frequencies for every variant that a variant effect needs to be generated</span></span>
<span><span class="co">#' @param h2 Heritability of the trait (e.g. BMI =~ 0.5)</span></span>
<span><span class="co">#' @param S Selection coefficient. 0 = neutral (no selection), +ve = positive selection, -ve = negative selection</span></span>
<span><span class="co">#' @param h2_inst Variance explained by the detected variants. e.g. for BMI =~ 0.05</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Data frame</span></span>
<span><span class="va">generate_beta_gx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">af</span>, <span class="va">h2</span>, <span class="va">S</span><span class="op">=</span><span class="fl">0</span>, <span class="va">h2_inst</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">nvariant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">h2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">0</span>, af<span class="op">=</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co"># Sample variant effects based on S and allele frequency</span></span>
<span>    <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nvariant</span>, mean<span class="op">=</span><span class="fl">0</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">af</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">af</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Scale effects to be in standard deviation units and to explain the total h2</span></span>
<span>    <span class="va">vg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">af</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">af</span><span class="op">)</span> <span class="op">*</span> <span class="va">beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">ve</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">vg</span> <span class="op">-</span> <span class="va">h2</span> <span class="op">*</span> <span class="va">vg</span><span class="op">)</span> <span class="op">/</span> <span class="va">h2</span></span>
<span>    <span class="va">vy</span> <span class="op">&lt;-</span> <span class="va">vg</span> <span class="op">+</span> <span class="va">ve</span></span>
<span>    <span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">vy</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Select variants to be detected as instruments</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>beta<span class="op">=</span><span class="va">beta</span>, af<span class="op">=</span><span class="va">af</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">rsq</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">beta</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">dat</span><span class="op">$</span><span class="va">af</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">dat</span><span class="op">$</span><span class="va">af</span><span class="op">)</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">rsq</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">rsq_cumsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">rsq</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">instrument</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">rsq_cumsum</span> <span class="op">&lt;=</span> <span class="va">h2_inst</span></span>
<span></span>
<span>    <span class="co"># If the first instrument explains all of instrument variance then just use that</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">instrument</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgx</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx</span><span class="op">(</span>af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, h2 <span class="op">=</span> <span class="fl">0.5</span>, S <span class="op">=</span> <span class="fl">0</span>, h2_inst <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">$</span><span class="va">instrument</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 393</span></span></code></pre>
<p>These parameters give something similar to the number of detected
hits for BMI. Check that the distribution of rsq values are similar. BMI
(black) and simulated (red):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmi_hits</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">rsq</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">rsq</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bgx</span>, <span class="va">instrument</span><span class="op">)</span><span class="op">$</span><span class="va">rsq</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The difference here is that a more appropriate model would be that
different sets of variants are drawn from different distributions. For
example, 1% of the variance could be explained by 10 variants, and the
other 4% by 400. variants. The model gets a bit verbose doing it like
this, potentially requring a different S parameter for different sets of
variants, which doesn’t really make sense.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_beta_gx2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">af</span>, <span class="va">h2</span>, <span class="va">S</span><span class="op">=</span><span class="fl">0</span>, <span class="va">h2_inst</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">h2</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">dat</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx</span><span class="op">(</span>af<span class="op">=</span><span class="va">af</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, h2<span class="op">=</span><span class="va">h2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, S<span class="op">=</span><span class="va">S</span>, h2_inst <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">rsq</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">beta</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">dat</span><span class="op">$</span><span class="va">af</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">dat</span><span class="op">$</span><span class="va">af</span><span class="op">)</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">rsq</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">rsq_cumsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">rsq</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">instrument</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">rsq_cumsum</span> <span class="op">&lt;=</span> <span class="va">h2_inst</span></span>
<span></span>
<span>    <span class="co"># If the first instrument explains all of instrument variance then just use that</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">instrument</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Try again:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgx</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx2</span><span class="op">(</span>af<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">80</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">90000</span><span class="op">)</span><span class="op">)</span>, h2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.48</span><span class="op">)</span>, S<span class="op">=</span><span class="fl">0</span>, h2_inst<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">$</span><span class="va">instrument</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 445</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmi_hits</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">rsq</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">rsq</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bgx</span>, <span class="va">instrument</span><span class="op">)</span><span class="op">$</span><span class="va">rsq</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>These parameters give something similar to the number and
distribution of detected hits for BMI. There are other things that we
haven’t accounted for here such as winner’s curse. Check that the
distribution of rsq values are similar.</p>
</div>
<div class="section level2">
<h2 id="model-1---simple-linear-relationship-between-x-and-y-with-large-numbers-of-instruments-of-small-effect">Model 1 - simple linear relationship between x and y with large
numbers of instruments of small effect<a class="anchor" aria-label="anchor" href="#model-1---simple-linear-relationship-between-x-and-y-with-large-numbers-of-instruments-of-small-effect"></a>
</h2>
<p><span class="math display">\[
\begin{aligned}
x_i &amp;= a^x + \beta_{xG}G_i + \beta_{xC}C_i + \epsilon^x_i \\
y_i &amp;= a^y + \beta_{yx} x_i + \beta_{yC}C_i + \beta_{yG}G_i +
\epsilon^y_i
\end{aligned}
\]</span></p>
<ul>
<li>
<span class="math inline">\(x_i\)</span> = exposure value for <span class="math inline">\(i\)</span>th individual</li>
<li>
<span class="math inline">\(a^x, a^y\)</span> = intercept terms</li>
<li>
<span class="math inline">\(y_i\)</span> = outcome value for <span class="math inline">\(i\)</span>th individual</li>
<li>
<span class="math inline">\(G\)</span> = matrix of genotypes for
each sample, only including genotypes to be used as instruments (not all
causal variants)</li>
<li>
<span class="math inline">\(\beta_xG\)</span> = vector of effects of
each variant in genotype matrix <span class="math inline">\(G\)</span>
on <span class="math inline">\(x\)</span>
</li>
<li>
<span class="math inline">\(\beta_{xC},\beta_{yC}\)</span> = effects
of confounders on <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>
</li>
<li>
<span class="math inline">\(\beta_{yG}\)</span> = vector of effects
of each variant on <span class="math inline">\(y\)</span>, independent
of <span class="math inline">\(x\)</span> (i.e. horizontal pleiotropic
effects)</li>
</ul>
<p>Expect quite substantial confounding and relatively small causal
effects. Easiest to talk about in terms of variance explained.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Title</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param sample_size </span></span>
<span><span class="co">#' @param af Vector of allele frequencies (should be between 0 and 1)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Matrix</span></span>
<span><span class="va">generate_G</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">af</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sample_size</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">sample_size</span>, <span class="fl">2</span>, <span class="va">af</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Scale genetic effects to satisfy heritability parameter</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Supposing that we want all our sampled effects to explain a particular amount of variance in the trait, we can transform those effects based on the allele frequencies of the variants</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param beta vector of effects</span></span>
<span><span class="co">#' @param af vector of allele frequencies</span></span>
<span><span class="co">#' @param h2 variance explained by the effects (assuming trait variance is 1)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return vector of scaled effects</span></span>
<span><span class="va">scale_bg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta</span>, <span class="va">af</span>, <span class="va">h2</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">vg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">af</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">af</span><span class="op">)</span> <span class="op">*</span> <span class="va">beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">ve</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">vg</span> <span class="op">-</span> <span class="va">h2</span> <span class="op">*</span> <span class="va">vg</span><span class="op">)</span> <span class="op">/</span> <span class="va">h2</span></span>
<span>    <span class="va">vy</span> <span class="op">&lt;-</span> <span class="va">vg</span> <span class="op">+</span> <span class="va">ve</span></span>
<span>    <span class="va">beta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">beta</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">vy</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Effect of x on y constant, with allowance for balanced pleiotropy</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param sample_size Sample size to generate</span></span>
<span><span class="co">#' @param h2 Heritability of x</span></span>
<span><span class="co">#' @param nvariants Number of causal variants of x</span></span>
<span><span class="co">#' @param h2_inst Variance explained by detected instruments</span></span>
<span><span class="co">#' @param S Selection coefficient</span></span>
<span><span class="co">#' @param maf_alpha Allele frequency distribution shape parameter, to be fed into beta distribution. </span></span>
<span><span class="co">#' @param maf_beta Allele frequency distribution shape parameter, to be fed into beta distribution. </span></span>
<span><span class="co">#' @param rsq_yx Causal variance explained in y by x</span></span>
<span><span class="co">#' @param rsq_xu Variance explained in x by unmeasured confounder</span></span>
<span><span class="co">#' @param rsq_yu Variance explained in y by unmeasured confounder</span></span>
<span><span class="co">#' @param rsq_yg Horizontal pleiotropy parameter, variance explained by all variants </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return List</span></span>
<span><span class="co">#' \itemize{</span></span>
<span><span class="co">#'   \item x - Vector</span></span>
<span><span class="co">#'   \item y - Vector</span></span>
<span><span class="co">#'   \item u - Vector</span></span>
<span><span class="co">#'   \item G - Matrix</span></span>
<span><span class="co">#' }</span></span>
<span><span class="va">dgp1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">h2</span>, <span class="va">nvariants</span>, <span class="va">h2_inst</span>, <span class="va">S</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span>, <span class="va">rsq_yx</span>, <span class="va">rsq_xu</span>, <span class="va">rsq_yu</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">rsq_xu</span> <span class="op">+</span> <span class="va">h2_inst</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">rsq_yu</span> <span class="op">+</span> <span class="va">rsq_yx</span> <span class="op">+</span> <span class="va">rsq_yg</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate allele frequencies for all causal variants</span></span>
<span>  <span class="va">af</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">nvariants</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate confounder</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate random errors for x and y</span></span>
<span>  <span class="va">epsilon_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">rsq_xu</span> <span class="op">-</span> <span class="va">h2_inst</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">epsilon_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">rsq_yu</span> <span class="op">-</span> <span class="va">rsq_yx</span> <span class="op">-</span> <span class="va">rsq_yg</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate instrument effects on x</span></span>
<span>  <span class="va">bgx</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx</span><span class="op">(</span>af<span class="op">=</span><span class="va">af</span>, h2<span class="op">=</span><span class="va">h2</span>, S<span class="op">=</span><span class="va">S</span>, h2_inst<span class="op">=</span><span class="va">h2_inst</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">instrument</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate genotype matrix</span></span>
<span>  <span class="va">G</span> <span class="op">&lt;-</span> <span class="fu">generate_G</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate horizontal pleiotropy effects</span></span>
<span>  <span class="va">bgy</span> <span class="op">&lt;-</span> <span class="fu">scale_bg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">)</span><span class="op">)</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate x and y</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">G</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bgx</span><span class="op">$</span><span class="va">beta</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rsq_xu</span><span class="op">)</span> <span class="op">+</span> <span class="va">epsilon_x</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">G</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bgy</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rsq_yu</span><span class="op">)</span> <span class="op">+</span> <span class="va">epsilon_y</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rsq_yx</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, u<span class="op">=</span><span class="va">u</span>, G<span class="op">=</span><span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dgp1</span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">0.5</span>, <span class="fl">40000</span>, <span class="fl">0.04</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">bgxhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="va">bgyhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = bgyhat$bhat ~ 0 + bgxhat$bhat, weights = 1/bgyhat$se^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -7.5978 -1.8682  0.0064  1.8419  7.1952 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## bgxhat$bhat  0.14003    0.06254   2.239   0.0259 *</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 2.716 on 297 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.0166, Adjusted R-squared:  0.01329 </span></span>
<span><span class="co">## F-statistic: 5.013 on 1 and 297 DF,  p-value: 0.0259</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  h2 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  nvariants <span class="op">=</span> <span class="fl">40000</span>,</span>
<span>  h2_inst <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  S <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  maf_alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  maf_beta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">400000</span>,</span>
<span>  rsq_yx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span><span class="op">)</span>, </span>
<span>  rsq_xu <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  rsq_yu <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  rsq_yg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-2---heterogeneous-treatment-effect-of-x-on-y-based-on-covariate">Model 2 - Heterogeneous treatment effect of x on y based on
covariate<a class="anchor" aria-label="anchor" href="#model-2---heterogeneous-treatment-effect-of-x-on-y-based-on-covariate"></a>
</h2>
<p>If there is a covariate <span class="math inline">\(c\)</span> that
can have an influence on both <span class="math inline">\(x\)</span> and
<span class="math inline">\(y\)</span>, but the causal effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> depends on the value of <span class="math inline">\(c\)</span>. Suppose that <span class="math inline">\(c\)</span> is split across <span class="math inline">\(k\)</span> strata, and the causal effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> is given as <span class="math inline">\(b_{xy}^k\)</span>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Effect of x on y varies based on covariate</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param sample_size Sample size to generate</span></span>
<span><span class="co">#' @param h2 Heritability of x</span></span>
<span><span class="co">#' @param nvariants Number of causal variants of x</span></span>
<span><span class="co">#' @param h2_inst Variance explained by detected instruments</span></span>
<span><span class="co">#' @param S Selection coefficient</span></span>
<span><span class="co">#' @param maf_alpha Allele frequency distribution shape parameter, to be fed into beta distribution. </span></span>
<span><span class="co">#' @param maf_beta Allele frequency distribution shape parameter, to be fed into beta distribution. </span></span>
<span><span class="co">#' @param r_yx Vector of causal effects of x on y. Samples will be split into a number of groups based on this vector. The split is based on the covariate value c. Assumes variance of x and y both 1</span></span>
<span><span class="co">#' @param r_xu Effect of unmeasured confounder on x (assuming variance of x and u both 1)</span></span>
<span><span class="co">#' @param r_yu Effect of unmeasured confounder on y (assuming variance of y and u both 1)</span></span>
<span><span class="co">#' @param r_xc Effect of interacting covariate on x (assuming variance of x and c both 1)</span></span>
<span><span class="co">#' @param r_yc Effect of interacting covariate on y (assuming variance of y and c both 1)</span></span>
<span><span class="co">#' @param rsq_yg Horizontal pleiotropy parameter, variance explained by all variants</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return List</span></span>
<span><span class="co">#' \itemize{</span></span>
<span><span class="co">#'   \item x - Vector</span></span>
<span><span class="co">#'   \item y - Vector</span></span>
<span><span class="co">#'   \item c - Vector</span></span>
<span><span class="co">#'   \item u - Vector</span></span>
<span><span class="co">#'   \item G - Matrix</span></span>
<span><span class="co">#' }</span></span>
<span><span class="va">dgp2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">h2</span>, <span class="va">nvariants</span>, <span class="va">h2_inst</span>, <span class="va">S</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span>, <span class="va">r_yx</span>, <span class="va">r_xu</span>, <span class="va">r_yu</span>, <span class="va">r_xc</span>, <span class="va">r_yc</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co"># The overall variance explained in y by x</span></span>
<span>  <span class="co"># This is probably wrong!</span></span>
<span>  <span class="va">rsq_yx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r_yx</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Checks</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">r_xu</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">r_xc</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">h2_inst</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">r_yu</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">r_yc</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">rsq_yx</span> <span class="op">+</span> <span class="va">rsq_yg</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate allele frequencies</span></span>
<span>  <span class="va">af</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">nvariants</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create unmeasured confounder</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create interaction variable c</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Error term in x</span></span>
<span>  <span class="va">epsilon_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_xu</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">r_xc</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">h2_inst</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Error term in y</span></span>
<span>  <span class="va">epsilon_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_yu</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">r_yc</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">rsq_yx</span> <span class="op">-</span> <span class="va">rsq_yg</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate instrument effects on x</span></span>
<span>  <span class="va">bgx</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx</span><span class="op">(</span>af<span class="op">=</span><span class="va">af</span>, h2<span class="op">=</span><span class="va">h2</span>, S<span class="op">=</span><span class="va">S</span>, h2_inst<span class="op">=</span><span class="va">h2_inst</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">instrument</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate genotype matrix</span></span>
<span>  <span class="va">G</span> <span class="op">&lt;-</span> <span class="fu">generate_G</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pleiotropic effects</span></span>
<span>  <span class="va">bgy</span> <span class="op">&lt;-</span> <span class="fu">scale_bg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">)</span><span class="op">)</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Simulate x and y (excluding x-&gt;y effect)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">G</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bgx</span><span class="op">$</span><span class="va">beta</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="va">r_xu</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">r_xc</span> <span class="op">+</span>  <span class="va">epsilon_x</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">G</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bgy</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="va">r_yu</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">r_yc</span> <span class="op">+</span> <span class="va">epsilon_y</span></span>
<span>  </span>
<span>  <span class="co"># Split sample into strata</span></span>
<span>  <span class="va">nstrata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_yx</span><span class="op">)</span></span>
<span>  <span class="va">quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out<span class="op">=</span><span class="va">nstrata</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># Add causal effect for each stratum</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nstrata</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;-</span> <span class="va">c</span> <span class="op">&gt;</span> <span class="va">quantiles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">c</span> <span class="op">&lt;=</span> <span class="va">quantiles</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">*</span> <span class="va">r_yx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, u<span class="op">=</span><span class="va">u</span>, c<span class="op">=</span><span class="va">c</span>, G<span class="op">=</span><span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dgp2</span><span class="op">(</span>sample_size<span class="op">=</span><span class="fl">10000</span>, h2<span class="op">=</span><span class="fl">0.5</span>, nvariants<span class="op">=</span><span class="fl">40000</span>, h2_inst<span class="op">=</span><span class="fl">0.05</span>, S<span class="op">=</span><span class="fl">0</span>, maf_alpha<span class="op">=</span><span class="fl">1</span>, maf_beta<span class="op">=</span><span class="fl">1</span>, r_yx<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>, r_xu<span class="op">=</span><span class="fl">0.1</span>, r_yu<span class="op">=</span><span class="fl">0.1</span>, r_xc<span class="op">=</span><span class="fl">0</span>, r_yc<span class="op">=</span><span class="fl">0</span>, rsq_yg<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">bgxhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="va">bgyhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = bgyhat$bhat ~ 0 + bgxhat$bhat, weights = 1/bgyhat$se^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -2.9780 -0.6758  0.0700  0.6898  3.3493 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## bgxhat$bhat 0.005868   0.034000   0.173    0.863</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.023 on 388 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  7.677e-05,  Adjusted R-squared:  -0.0025 </span></span>
<span><span class="co">## F-statistic: 0.02979 on 1 and 388 DF,  p-value: 0.8631</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">c</span><span class="op">)</span></span>
<span><span class="va">bgxhat1</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">[</span><span class="va">index</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bgyhat1</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">[</span><span class="va">index</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bgxhat2</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">index</span><span class="op">]</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">[</span><span class="op">!</span><span class="va">index</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bgyhat2</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="op">!</span><span class="va">index</span><span class="op">]</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">[</span><span class="op">!</span><span class="va">index</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bgyhat1</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">bgxhat1</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bgyhat1</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">bgxhat1</span><span class="op">$</span><span class="va">bhat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">bgyhat1</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = bgyhat1$bhat ~ 0 + bgxhat1$bhat, weights = 1/bgyhat1$se^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -2.84883 -0.71009 -0.05424  0.65902  2.43838 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## bgxhat1$bhat -0.18696    0.03685  -5.074 6.06e-07 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.9821 on 388 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.06222,    Adjusted R-squared:  0.0598 </span></span>
<span><span class="co">## F-statistic: 25.74 on 1 and 388 DF,  p-value: 6.061e-07</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bgyhat2</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">bgxhat2</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bgyhat2</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">bgxhat2</span><span class="op">$</span><span class="va">bhat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">bgyhat2</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = bgyhat2$bhat ~ 0 + bgxhat2$bhat, weights = 1/bgyhat2$se^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -3.15894 -0.56909  0.05947  0.70074  2.97214 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## bgxhat2$bhat  0.17995    0.03962   4.542 7.44e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.9747 on 388 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.05049,    Adjusted R-squared:  0.04804 </span></span>
<span><span class="co">## F-statistic: 20.63 on 1 and 388 DF,  p-value: 7.442e-06</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-3---the-interacting-variable-from-2-is-proxied-by-a-large-number-of-proxies">Model 3 - The interacting variable from (2) is proxied by a large
number of proxies<a class="anchor" aria-label="anchor" href="#model-3---the-interacting-variable-from-2-is-proxied-by-a-large-number-of-proxies"></a>
</h2>
<p>Generate proxies to <span class="math inline">\(C\)</span> using
Cholesky decomposition of a randomly generated correlation matrix</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_cors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">C</span>, <span class="va">nproxy</span>, <span class="va">cors</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">cors</span>, <span class="va">nproxy</span><span class="op">+</span><span class="fl">1</span>, <span class="va">nproxy</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cormat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">cormat</span><span class="op">)</span><span class="op">$</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">nproxy</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span>, <span class="va">nproxy</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">C</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">cormat</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Perform simulation using <code>dgp2()</code> as in Model 2, and now
create proxies traits for <code>dat$c</code> using the
<code>generate_cors()</code> function. This is pretty simple, but could
generate likely correlation structures from real data.</p>
</div>
<div class="section level2">
<h2 id="model-4---heterogeneous-treatment-effect-at-the-instrument-level">Model 4 - Heterogeneous treatment effect at the instrument
level<a class="anchor" aria-label="anchor" href="#model-4---heterogeneous-treatment-effect-at-the-instrument-level"></a>
</h2>
<p>In models 2 and 3 the treatment effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> varies based on individual’s status at
<span class="math inline">\(c\)</span>. Including <span class="math inline">\(C\)</span> in DeepIV helps obtain treatment
effects at different levels of <span class="math inline">\(C\)</span>.
In this model we look at heterogeneous treatment effects at the
instrument level - that is where each instrument influences the outcome
through a different mechanism. This is somewhat similar to the model
assumed by the modal based estimator, in that instruments will cluster
based on similarity of effect estimate. However, here we include
variables that specify the clusters. Ideally, a model would identify
that BMI does not have a causal effect but the proxy variables do.</p>
<p>Suppose that the set of genetic influences on BMI arise because BMI
itself is a composite of several other traits. BMI itself doesn’t have a
causal effect on coronary heart disease, but it captures some traits
that do have a causal effect.</p>
<p>For example,</p>
<ul>
<li>BMI = Body mass index</li>
<li>CHD = Coronary heart disease</li>
<li>Adi = Adiposity</li>
<li>Mus = Muscle mass</li>
<li>BMD = Bone mineral density</li>
</ul>
<p>We are estimating the effect of BMI on CHD, but as can be seen, BMI
has no influence. It is influenced by adiposity and muscle mass that
each have effects on ChD. It is also influenced by bone mineral density
that has no effect on CHD. So all the instruments for BMI are actually
instruments for those other traits.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html" class="external-link">dagify</a></span><span class="op">(</span><span class="va">Mus</span> <span class="op">~</span> <span class="va">G1</span>,</span>
<span>       <span class="va">Adi</span> <span class="op">~</span> <span class="va">G2</span>,</span>
<span>       <span class="va">BMD</span> <span class="op">~</span> <span class="va">G3</span>,</span>
<span>       <span class="va">BMI</span> <span class="op">~</span> <span class="va">Mus</span> <span class="op">+</span> <span class="va">Adi</span> <span class="op">+</span> <span class="va">BMD</span>,</span>
<span>       <span class="va">CHD</span> <span class="op">~</span> <span class="va">Mus</span> <span class="op">+</span> <span class="va">Adi</span>,</span>
<span>       exposure<span class="op">=</span><span class="st">"BMI"</span>, outcome<span class="op">=</span><span class="st">"CHD"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag_classic.html" class="external-link">ggdag_classic</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag_blank</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>If we begin with effect sizes for BMI we can back calculate the
genetic effects on each of the influencing factors <span class="math inline">\(P\)</span>, given causal effects of those values
on BMI.</p>
<p><span class="math display">\[
\beta_{pg} = \beta_{xg} / \beta_{xp}
\]</span></p>
<p>We can construct BMI and CHD from each of the influencing factors
<span class="math inline">\(P_k\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
P_k &amp;= G_k \beta^k_{pg} + u \beta_{P_Ku} + e^{P_k} \\
x &amp;= P\beta_{xp} + u \beta_{xu} + e^x \\
y &amp;= P\beta_{yp} + u \beta_{yu} + e^y
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param sample_size </span></span>
<span><span class="co">#' @param h2 heritability of x</span></span>
<span><span class="co">#' @param nvariants number of variants influencing x overall</span></span>
<span><span class="co">#' @param h2_inst variance explained by detected instruments for x</span></span>
<span><span class="co">#' @param S selection coefficient</span></span>
<span><span class="co">#' @param maf_alpha maf parameter</span></span>
<span><span class="co">#' @param maf_beta maf parameter</span></span>
<span><span class="co">#' @param r_yx causal effect of x on y. Intention is for this to be 0 in this model</span></span>
<span><span class="co">#' @param r_xu confounding effect on x</span></span>
<span><span class="co">#' @param r_yu confounding effect on y</span></span>
<span><span class="co">#' @param r_xp vector of effects for each P on x. e.g. effects of BMD, adiposity and muscle mass on BMI</span></span>
<span><span class="co">#' @param r_yp vector of effects for each P on y. e.g. effects of BMD, adiposity and muscle mass on CHD</span></span>
<span><span class="co">#' @param r_pu vector of effects of unmeasured confounder on p</span></span>
<span><span class="co">#' @param rsq_yg horizontal pleiotropy. variance explained by genetic variants on y directly</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return list of </span></span>
<span><span class="va">dgp4</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">h2</span>, <span class="va">nvariants</span>, <span class="va">h2_inst</span>, <span class="va">S</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span>, <span class="va">r_yx</span>, <span class="va">r_xu</span>, <span class="va">r_yu</span>, <span class="va">r_xp</span>, <span class="va">r_yp</span>, <span class="va">r_pu</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co"># Checks</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">r_xu</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_xp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">h2_inst</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">r_yu</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_yp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">r_yx</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">rsq_yg</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate allele frequencies</span></span>
<span>  <span class="va">af</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">nvariants</span>, <span class="va">maf_alpha</span>, <span class="va">maf_beta</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create unmeasured confounder</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Error term in x</span></span>
<span>  <span class="va">epsilon_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_xu</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_xp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">h2_inst</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Error term in y</span></span>
<span>  <span class="va">epsilon_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_yu</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_yp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">r_yx</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">rsq_yg</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate instrument effects on x</span></span>
<span>  <span class="va">bgx</span> <span class="op">&lt;-</span> <span class="fu">generate_beta_gx</span><span class="op">(</span>af<span class="op">=</span><span class="va">af</span>, h2<span class="op">=</span><span class="va">h2</span>, S<span class="op">=</span><span class="va">S</span>, h2_inst<span class="op">=</span><span class="va">h2_inst</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">instrument</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate genotype matrix</span></span>
<span>  <span class="va">G</span> <span class="op">&lt;-</span> <span class="fu">generate_G</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pleiotropic effects</span></span>
<span>  <span class="va">bgy</span> <span class="op">&lt;-</span> <span class="fu">scale_bg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">)</span><span class="op">)</span>, <span class="va">bgx</span><span class="op">$</span><span class="va">af</span>, <span class="va">rsq_yg</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate P variables</span></span>
<span>  <span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_yp</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_yp</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_xp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_pu</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_xp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sample_size</span>, <span class="va">np</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Choose variants in bgx for each P</span></span>
<span>  </span>
<span>  <span class="co"># Split the variants based on trait's effect on x</span></span>
<span>  <span class="va">props</span> <span class="op">&lt;-</span> <span class="va">r_xp</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_xp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">)</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">np</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bgx</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="va">props</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">gbv</span> <span class="op">&lt;-</span> <span class="va">G</span><span class="op">[</span>,<span class="va">index</span><span class="op">==</span><span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">bgx</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="va">index</span><span class="op">==</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="va">r_xp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gbv</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="va">r_pu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_pu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">gbv</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>    </span>
<span>  <span class="co"># Simulate x and y</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">r_xp</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="va">r_xu</span> <span class="op">+</span>  <span class="va">epsilon_x</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">G</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bgy</span> <span class="op">+</span> <span class="va">u</span> <span class="op">*</span> <span class="va">r_yu</span> <span class="op">+</span> <span class="va">P</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">r_yp</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">r_yx</span> <span class="op">+</span> <span class="va">epsilon_y</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, u<span class="op">=</span><span class="va">u</span>, P<span class="op">=</span><span class="va">P</span>, G<span class="op">=</span><span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dgp4</span><span class="op">(</span>sample_size<span class="op">=</span><span class="fl">10000</span>, h2<span class="op">=</span><span class="fl">0.5</span>, nvariants<span class="op">=</span><span class="fl">40000</span>, h2_inst<span class="op">=</span><span class="fl">0.05</span>, S<span class="op">=</span><span class="fl">0</span>, maf_alpha<span class="op">=</span><span class="fl">1</span>, maf_beta<span class="op">=</span><span class="fl">1</span>, r_yx<span class="op">=</span><span class="fl">0</span>, r_xu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, r_yu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, r_xp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>, r_yp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0</span><span class="op">)</span>, r_pu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>, rsq_yg<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## index</span></span>
<span><span class="co">##   1   2   3 </span></span>
<span><span class="co">##  93 245  52</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgxhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="va">bgyhat</span> <span class="op">&lt;-</span> <span class="fu">simulateGP</span><span class="fu">::</span><span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span>, <span class="va">dat</span><span class="op">$</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></span></code></pre></div>
<p><img src="mr_dgp_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">bgxhat</span><span class="op">$</span><span class="va">bhat</span>, weight<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">bgyhat</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = bgyhat$bhat ~ 0 + bgxhat$bhat, weights = 1/bgyhat$se^2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weighted Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -3.3752 -0.8426  0.1234  0.8539  3.1775 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## bgxhat$bhat  0.12775    0.03797   3.365 0.000842 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.175 on 389 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.02828,    Adjusted R-squared:  0.02579 </span></span>
<span><span class="co">## F-statistic: 11.32 on 1 and 389 DF,  p-value: 0.0008416</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gibran Hemani, John Ferguson, Rita Rasteiro.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
